<!DOCTYPE html>
<!--
â¢„â €â €â €â €â €â €â €â €â €â €â €â¢‘â •â „â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â¡£â €â €â €â €â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â â €â €â €â â €â €â â¡€â „â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â¢€â ‚â €â €â ‚â ˆâ €â â €â €â €â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â¢‚â¡‚â €â €â €â „â ‚â €â ‚â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â â¡¨â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â¢¢â¢€â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â „â ˆâ €
â „â ¡â¢â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â  â €â €â €â â €â €â €
â €â …â¢‚â ‚â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â â €â €â €â €â €â €â €â €
â €â¢€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ‚â €â €â €â €â €â¡€â €â €
â Šâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ‚â¢€â €â €â â €â €â €â €
â ˆâ¡€â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ‚â €â €â €â €â €â €â €
â €â¡€â  â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ‚â¡€â €â €â¢€â  â €
â €â „â¡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢°â¢¶â£¤â£€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢€â£ â¢¤â €â €â €â €â €â €â €â €â €â €â €â €â â¡€â €â „â €â €
â¢€â¡Šâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ‰â ‰â â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â â ³â ›â »â €â €â €â €â €â €â €â €â €â €â €â €â €â â â¡€â €â €
â •â¡Œâ  â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â Šâ¢„â ‚
â¢…â £â¡‚â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ‚â €â Š
â¢Šâ¢Žâ ”â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €
â¢±â ¨â¡ªâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡€â¡€â¢€â €â €â €â €â €â €
â¢•â¢±â¢¨â  â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡ â¢‘â¢”â •â¡…â¡‚â¡‚â €â¡€â €â €
â¢•â¢±â¢¨â ªâ¡‚â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â  â¢˜â¢œâ¢œâ¢œâ¢œâ¢œâ „â €â â â €
â¢…â ‡â¡Žâ£Šâ ¢â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢•â¢œâ¢œâ¢¸â¢¨â¢¢â £â¡±â €â¡â¢ˆ
â¢…â¢‡â¢Žâ¢†â …â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢±â¡±â¡‘â¡…â¡‡â¡ªâ¡ªâ¡¸â¡°â¡â¢”
â¢•â¢•â¢±â ¡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ‚â¡£â¡£â¡£â¡ªâ¢ªâ ¸â¡¨â¡ªâ¡¸â¡
â •â¡…â¡‡â¢•â ¡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡€â£„â¡â¢„â „â €â¢€â ¸â¡ªâ¡ªâ¡ªâ¡Šâ¡Žâ¡Žâ¡Žâ¡Žâ¡Ž
â¡ªâ¢ªâ¢¸â¢¨â ¨â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢¤â£ â¡€â €â €â €â €â €â €â €â£€â¡„â¡€â €â €â €â €â €â¢€â¢£â¢’â¢œâ °â¡‘â¢•â¢â¢Œâ¢ºâ¡¸â¡ªâ¡ªâ¡ªâ¡¸â¡¨â¡ªâ¡˜
â¡ªâ¡ªâ¡¢â¢£â¢‘â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â£»â¡»â ½â£ºâ£€â£ â¡€â£„â£®â žâ¢¾â£¿â „â €â €â €â €â €â €â ‚â¡£â¡±â¡‘â¡•â¢…â¢•â œâ¡”â¡•â¡â¡Žâ¡Žâ¡Žâ¡Žâ¡†â¢‡
â¢Šâ¢Žâ¢ªâ ªâ¢Œâ ‚â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ™â¢·â¡…â¢ˆâ â ‰â ˆâ â ‰â¢â¢¼â¡žâ €â €â €â €â €â €â €â €â ¨â¡ªâ¡Šâ¡Žâ¢†â¢£â¢±â¢‘â œâ¡œâ¡œâ¡œâ¡œâ¡œâ¢œâ¢Œ
â¡â¡¡â¡ƒâ¢‡â …â €â €â ‚â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ‰â ‹â „â €â „â €â €â €â¢˜â ™â €â €â €â €â €â €â €â €â €â €â¢ˆâ ˜â œâ¡•â¡±â¡¡â¡£â¡±â¡¡â¡£â¡±â¡±â¢±â ±â£‘
â¢â¢¢â¢ªâ ‚â €â €â¢€â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â â ‚â¡â Œâ¡¢â ±â¡±â¡¸â¡°â¢±â¢±â¢¸â ¸â¡˜â¡”
â¢ˆâ¢Šâ ‚â ‚â €â¢€â¢â €â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â â¢ˆâ Šâ ªâ¡Šâ¡Žâ¢†â¢‡â¢‡â¢‡â¢‡â £
â¢€â €â¡€â ‚â €â â Œâ „â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â …â¢±â ±â¡±â¡±â£±â¢±â¢˜â Œ

wtf are you looking at
-->
<html lang="en">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <head>
       <meta charset='UTF-8' name='viewport' content='width=device-width, initial-scale=1.0'>
       <link href="/assets/css/hack.css" rel="stylesheet" type="text/css">
       <link href="/assets/css/dark-grey.css" rel="stylesheet" type="text/css">
       <link href="/assets/css/site.css" rel="stylesheet" type="text/css">
       <title>${title}</title>
    </head>
   <body class="hack dark-grey">
      <div class="root container">
         <header>
            <nav>
               <a href="/">Home</a>
               <a href="/blog">Blog</a>
               <a href="/contact">Contact</a>
            </nav>
         </header>
         <br/>
         <br/>
         <hr>
         <p>Date: 26/09/2023</p>
         <hr>
         <h1>How I write and publish blogs</h1>
         <p>The following post will attempt to go through the step by step process which I take when I would like to author and publish new blogs to this website.</p>
         <br/>
         <h3>Obsidian</h3>
         <p>The blogs themselves are written using Markdown (if you don't know what Markdown (<code>.md</code>) files are somehow, you can read more about them <a href="https://www.markdownguide.org/">here</a>). Obsidian is, amongst other things, great as a Markdown editor. It has native support for VIM bindings, and provides immediate feedback by rendering the document as you work on it.</p>
         <br/>
         <p>I already use Obsidian as my &quot;second brain&quot; day to day to collect notes, snippets/quotes from other media and works, and so I can also take advantage of all of the plugins I already use to do stuff, including planning blog posts in advance using &quot;daily notes&quot;.</p>
         <br/>
         <p>Obsidian also renders externally referenced assets such as images in place, which is very useful. When I open Obsidian to edit the blogs, I open the directory <code>./site/blogs</code> as the &quot;vault&quot; to use. Within this directory are all of the Markdown files which each represent an individual blog post, and another sub directory <code>static</code>, which is where all images and other referenced assets live.</p>
         <br/>
         <p>As the below screenshot shows, I have set up Obsidian (for this vault, settings are stored per vault which is also very useful) to always place new assets which are &quot;pasted&quot; into the document in this location, and reference them using a relative path, such as <code>![obsidian settings](/static/obsidian-settings.png)</code>, which comes in handy later on as we will see.</p>
         <br/>
         <p><img src="/static/obsidian-settings.png" alt="obsidian settings"></p>
         <h3>Attachment file names</h3>
         <p>There is a slight caveat to this system, in that at this point of the blog authoring process it makes no difference, but I do have to make sure the names of these are all lowercased and delimited by <code>-</code> rather than whitespace. Something like <code>Screenshot 2023-09-26 at 10.52.39</code> for example is not going to work later on.</p>
         <br/>
         <h2>Compiling/building</h2>
         <p>Once a blog post has been created, edited etc., the next step is to run <code>just compile-blogs</code>. This is a <code>justfile</code> command which runs this: <code>v run compile_blogs.v</code> in the root of the website repository. <code>compile_blogs.v</code> is a discrete V program which is responsible for parsing all existing markdown files within the <code>./blogs</code> directory and generating required output.</p>
         <br/>
         <h3>The code</h3>
         <p>This is the entry point function to <code>compile_blogs.v</code>:</p>
         <p><img src="/static/compile-blogs-entrypoint.png" alt="compile blogs entrypoint"></p>
         <p>You can see here that the first function invoked is called <code>compile_markdown_blogs_into_html_files</code>. Happily the function name is very clear and self documenting, but we might as well take a look to see what it is doing.</p>
         <br/>
         <h3>Step 1a.</h3>
         <p><img src="/static/cmbihf-first-few-lines.png" alt="cmbihf first few lines"></p>
         <p>The first few lines are ensuring that the directory which we want to read from (the blog Markdown files directory), and the directory which we would like to write to both exist already. I could just create them if they do not exist, but for now I'd rather now. I don't really know why exactly, but I think it's because they shouldn't ever not be there anyways, and if they are indeed missing, something else is probably wrong.</p>
         <h3>Step 1b.</h3>
         <p>Then this: <code>os.walk(&quot;./src/blog&quot;, fn (path string) { os.rm(path) or { ... } })</code> ensures that the target directory is empty. When we run this compile process, each blog is &quot;rebuilt&quot; each time, even if no changes have occurred. We could do better, but for now there's so little blog posts that there's no good reason to spend time optimising/making stuff more complicated for very little gain.</p>
         <h3>Step 2.</h3>
         <p><img src="/static/for-each-blog-entry.png" alt="for each blog entry"></p>
         <p>Next up, for every file which exists with an extension of <code>.md</code> within the blogs directory, we create and write to a new file with the same name, but one which has a <code>.html</code> extension. We then immediately write the previously extracted header template (which is shared across all site pages) to this file.</p>
         <br/>
         <h3>Step 3.</h3>
         <p><img src="/static/convert-line-by-line.png" alt="convert line by line"></p>
         <p>The rest of this function is then an iteration over each line of the current Markdown file we are working on. First we allocate a list of bytes 1024 (or 1kb) in size called <code>buffer</code>. We then call the V std library method on our open file descriptor to read as many bytes as available into our buffer.</p>
         <br/>
         <h4>What does <code>read_bytes_into_newline</code> mean/do?</h4>
         <p>If we check the V std lib documentation for this method, we find the following:</p>
         <p><img src="/static/std-lib-doc.png" alt="std lib doc"></p>
         <p>The last line (which incidentally seems to be incorrectly worded) is of most interest in the case of the above code. What it means is simply that the function will return if:</p>
         <ol>
<li>The buffer is filled up before a newline is encountered</li>
</ol>
         <ol start="2">
<li>A newline is encountered</li>
</ol>
         <ol start="3">
<li>The file's EOF is reached</li>
</ol>
         <br/>
         <p>That's the reason for the following branches, after we invoke this read method:</p>
         <br/>
         <h4>Branch 1.</h4>
         <p><code>if read_bytes == 1024 {</code></p>
         <p><code>        input_line := buffer.bytestr()</code></p>
         <p><code>        output_line := markdown.to_html(input_line)</code></p>
         <p><code>        wfd.write_string(output_line) or { println(&quot;unable to write to file: ${target}&quot;); return }</code></p>
         <p><code>        return</code></p>
         <p><code>}</code></p>
         <br/>
         <p>and</p>
         <br/>
         <h4>Branch 2.</h4>
         <p><code>if read_bytes &lt; 1024 {</code></p>
         <p><code>    mut output_line := &quot;&lt;br/&gt;&quot;</code></p>
         <p><code>    if read_bytes &gt; 1 {</code></p>
         <p><code>    input_line := buffer[..read_bytes - 1].bytestr()</code></p>
         <p><code>    output_line = markdown.to_html(input_line)</code></p>
         <p><code>}</code></p>
         <p><code>wfd.writeln(output_line) or { println(&quot;unable to write to file: ${target}&quot;); return }</code></p>
         <p><code>}</code></p>
         <br/>
         <p>For branch 1. it basically takes the fact that the whole buffer was filled to mean that the line it just read has yet to finish, so it must be just a really long line. We don't really care, and we therefore just convert all of the line we've read so far into HTML from Markdown.</p>
         <br/>
         <p>For branch 2. we didn't fill up the whole buffer before returning, and so we must have encountered a newline (or EOF). In this situation, we want to check if the line is more than one character long, if it is we convert this line, excluding it's newline (we assume it has one, as of yet we're not handling the EOF case! ðŸ˜®) If the line is only one character long, we assume it's a newline character on its own, and we convert that into padding.</p>
         <br/>
         <h4>Finally</h4>
         <p>The final line at the end of this function just writes the previously read HTML footer to the end of the new HTML file.</p>
         <br/>
         <br/>
         <br/>
      </div>
    </body>
</html>
